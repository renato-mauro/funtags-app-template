(function (factory) {
    typeof define === 'function' && define.amd ? define(factory) :
    factory();
})((function () { 'use strict';

    const ft = (function(){
        const HTML_NS = "http://www.w3.org/1999/xhtml";
        const SVG_NS = "http://www.w3.org/2000/svg";
        function tagFactory(NS,tagName) {
            return function(...args) {
                let element = document.createElementNS(NS,tagName);
                function flatten(e) {
                    if(e !== null && e !== "") {
                        if(e.forEach) {
                            e.forEach(flatten);
                        } else {
                            if (e instanceof Node) {
                                element.append(e);
                            } else if(e instanceof Object) {
                                for(let k in e) {
                                    let v = e[k];
                                    if(v !== null) {
                                        let evname = (/^on(.+)$/.exec(k)||[])[1];
                                        if(evname) {
                                            element.addEventListener(evname,v);
                                        } else if(k === 'style') {
                                            for(let ks in v) {
                                                element.style[ks] = v[ks];
                                            }
                                        } else {
                                            element.setAttribute(k,v);
                                        }
                                    }
                                }
                            } else {
                                element.append(document.createTextNode(e));
                                element.normalize();
                            }
                        }
                    }
                }
                flatten(args);        
                return element;
            }
        }
        return {
            html: new Proxy({}, {get:(target,name)=>(name in target)?target[name]:tagFactory(HTML_NS,name)}),
            svg: new Proxy({}, {get:(target,name)=>(name in target)?target[name]:tagFactory(SVG_NS,name)})
        }
    })();

    function sideBarCollapsibleMenu(menuData) {

        const { div, ul, li, a, button, style } = ft.html;

        function sideBarMenuCSS() {
            let s = style();
            s.textContent = `
            @import url('css/bootstrap.min.css');
    
            .btn-toggle {
                padding: .25rem .5rem;
                font-weight: 600;
                color: rgba(0, 0, 0, .65);
            }
          
            .btn-toggle::before {
                width: 1.25em;
                line-height: 0;
                content: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='rgba%280,0,0,.5%29' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 14l6-6-6-6'/%3e%3c/svg%3e");
                transition: transform .35s ease;
                transform-origin: .5em 50%;
            }
          
            .btn-toggle.show {
                color: rgba(0, 0, 0, .85);
            }
          
            .btn-toggle.show::before {
                transform: rotate(90deg);
            }
          
            .btn-toggle-nav a {
                padding: .1875rem .5rem;
                margin-top: .125rem;
                margin-left: 1.25rem;
            }
    
            .btn-toggle-nav a:hover {
                background-color: #ddd;
            }
          
            .btn-toggle-nav a.selected {
                background-color: #999;
            }
        `;
            return s;
        }

        let root;
        function adjustSelected() {
            root.querySelectorAll("a").forEach(element=>{
                element.classList.remove("selected");
            });
            this.classList.add("selected");
        }

        function subMenuItems(d) {

            function itemElement(item) {
                const aAttrs = { 
                    "class": "link-dark d-inline-flex text-decoration-none rounded",
                    onclick: adjustSelected
                };
                return li(a({href:item.href,...aAttrs},item.text));
            }

            const ulAttrs = { 
                "class": "btn-toggle-nav list-unstyled fw-normal pb-1 small" 
            };

            return div({"class":"collapse"},
                ul(ulAttrs,...d.map(itemElement))
            );
        }

        function menuItem(d) {
            let bt, bsCollapsible, subMI;

            const btAttr = {
                "class":"btn btn-toggle d-inline-flex align-items-center rounded border-0",
                "onclick": () => {
                    if(subMI.classList.contains("show")) {
                        bt.classList.remove("show");
                        bsCollapsible.hide();
                    } else {
                        bt.classList.add("show");
                        bsCollapsible.show();
                    }
                }
            };
            bt = button(btAttr,d.text);
            if(d.open) {
                bt.classList.add("show");
            }
            subMI = subMenuItems(d.children);
            bsCollapsible = bootstrap.Collapse.getOrCreateInstance(subMI,{toggle:d.open});
            if(d.divideBefore) {
                return [ li({"class": "border-top my-3"}), li({"class":"mb-1"},bt,subMI) ]
            } else {
                return li({"class":"mb-1"},bt,subMI);
            }
        }

        root = ul({"class":"list-unstyled ps-0"},
            ...menuData.map(menuItem)
        );

        let result = div();
        let shadow = result.attachShadow({mode:'open'});
        shadow.appendChild(sideBarMenuCSS());
        shadow.appendChild(root);

        document.addEventListener("pagechange",ev=>{
            let hash = ev.detail.hashName;
            root.querySelectorAll("a").forEach(e=>{
                if(e.getAttribute("href")==hash) {
                    e.classList.add("selected");
                } else {
                    e.classList.remove("selected");
                }
            });
        });

        return result;
    }

    function mainTemplate(title,menuData,content) {

        const { div, a, span, main } = ft.html;

        const mainStyle = {
            "height": "100vh",
            "max-height": "100vh",
            "overflow-x": "auto",
            "overflow-y": "hidden"
        };
        const sideBarDivAttrs = {
            "class": "flex-shrink-0 p-3 bg-light",
            "style": {
                "width": "230px",
                "height": "100vh"
            }
        };
        const titleAttrs = {
            "href": "/",
            "class": "d-flex align-items-center link-dark text-decoration-none"
        };
        const contentAttrs = {
            "class": "flex-fill",
            "style": {
                "overflow-y":"auto"
            }
        };

        document.body.replaceChildren(
            main({"class":"d-flex flex-nowrap",style:mainStyle},
                div(sideBarDivAttrs,
                    a(titleAttrs,span({"class":"fs-5 fw-semibold"},title)),
                    div(sideBarCollapsibleMenu(menuData))
                ),
                div(contentAttrs,content)
            )
        );
    }

    function loremIpsum(title) 
    {
        if(!title || title.length==0) {
            title = "Lorem Ipsum";
        }
        const { div } = ft.html;
        let resp = div({class:"p-4"});
        resp.innerHTML = `
        <h1>${title}</h1>
        <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent vitae nisl sem. Proin vulputate condimentum nunc, facilisis tempor tortor pellentesque vitae. Praesent semper, metus non posuere convallis, est magna tincidunt ante, et viverra nulla ante ac mauris. Sed imperdiet porta nunc ac mattis. Aliquam erat volutpat. Maecenas tristique ultricies lobortis. Sed lorem felis, vestibulum sit amet ligula in, convallis auctor enim. Donec ullamcorper tristique massa sit amet mollis. Nulla facilisi. Nullam suscipit ipsum ipsum, at tempor dui luctus cursus.
        </p>
        <p>
        Vivamus et vehicula elit, at dignissim arcu. Fusce eget lectus nibh. Praesent mattis tellus in nisl consectetur venenatis. Sed quis consectetur erat, a iaculis lacus. Curabitur pulvinar elit risus, at faucibus leo finibus vitae. Aenean eu purus sit amet dolor tincidunt scelerisque nec sed massa. Nullam nec nibh luctus, interdum justo at, tincidunt libero. Pellentesque non odio in justo eleifend consequat. Mauris commodo odio turpis, sed porttitor erat ullamcorper nec. Ut vitae ante pharetra, posuere leo vitae, facilisis neque. Proin gravida auctor nibh, pellentesque rutrum massa convallis vel. Proin luctus felis eu varius tempor. Vivamus sem felis, blandit eu eleifend et, ullamcorper in lacus. Sed eleifend, neque id tincidunt tincidunt, ipsum ipsum vestibulum ligula, fermentum tristique diam felis vitae velit. Phasellus consequat rhoncus diam. Quisque enim neque, rhoncus id odio a, scelerisque consectetur sapien.
        </p>
        <p>
        Praesent fermentum malesuada massa sed porttitor. Mauris dapibus sem eget nisl semper, ac porttitor dolor auctor. Vestibulum purus ligula, mollis sed sollicitudin ut, consequat ut metus. Nam ut ipsum et libero varius ultrices id sit amet magna. Integer dignissim eros in leo efficitur tincidunt. Curabitur eu tempor tortor. Pellentesque pellentesque sed diam suscipit tincidunt. Pellentesque non mi vestibulum, ullamcorper ante quis, efficitur lectus. Nam diam turpis, fringilla et eleifend eu, volutpat et ex. Donec consectetur, diam id egestas tempor, ex lorem finibus est, mattis consectetur lectus velit vitae lectus. Donec sapien nisi, semper vitae neque ac, convallis aliquam nulla. Nunc auctor nec nisl at fermentum. Aenean nec urna id ipsum aliquam aliquam sed a eros. Nulla vitae dolor vel risus cursus feugiat vitae quis sem.
        </p>
        <p>
        Cras eu nisi non justo consequat laoreet et non enim. Proin eget maximus lorem, in viverra justo. Donec turpis enim, imperdiet vitae ante eu, hendrerit consectetur ante. Nulla auctor rhoncus quam a pulvinar. Nullam luctus a leo eget euismod. Mauris eget sem eget enim dictum dapibus nec eu orci. Ut nibh eros, efficitur quis egestas quis, vehicula nec quam. Morbi tortor tellus, dapibus et magna in, pulvinar venenatis nulla. Pellentesque ultrices laoreet urna, non hendrerit velit posuere ut. Vivamus id massa eget nisi tempus pellentesque sit amet in tortor. Morbi non tellus non tortor finibus faucibus et convallis ex.
        </p>
        <p>
        Vestibulum et eleifend nunc. Morbi sem justo, ultricies a lorem sed, viverra rutrum elit. Mauris commodo vestibulum nunc sit amet ullamcorper. Integer eget mauris dignissim, dictum urna at, fermentum tellus. Nunc et leo nibh. Cras sagittis ultrices dui et tristique. Fusce faucibus, nisl et aliquam sollicitudin, est urna commodo ligula, vitae egestas arcu massa in odio. Nulla tincidunt sit amet dui sed faucibus. Fusce accumsan suscipit est, in suscipit lectus vestibulum a. Quisque aliquet sed est in egestas. Ut suscipit justo sed velit gravida, id finibus mauris elementum. Duis ut tellus et metus aliquam luctus in sed orci. Nullam rhoncus eget lectus in tempus. Quisque rutrum turpis vitae nisi consequat molestie.
        </p>
        <p>
        Nulla id quam sed lectus cursus accumsan. Nunc ante dui, lacinia a interdum ut, elementum et justo. Nulla facilisi. Nunc accumsan velit accumsan nisi varius porta. Integer facilisis leo ut tortor dictum, ut rhoncus ante volutpat. Proin quis est dui. Vestibulum augue nunc, placerat ac convallis sit amet, placerat et libero. Vivamus congue quis justo et venenatis. Sed sagittis ligula mi, quis cursus quam ornare et.
        </p>
        <p>
        Nunc dapibus lacus vel sapien condimentum mollis. Mauris a gravida lacus. Pellentesque viverra sem quis sapien ullamcorper venenatis. Donec at mi dui. Praesent pretium urna a ornare aliquam. Ut id libero sodales, aliquam odio eget, lobortis sem. Interdum et malesuada fames ac ante ipsum primis in faucibus. Maecenas non erat leo. Suspendisse viverra malesuada ipsum et ornare. Nunc sed elit eu magna vestibulum ullamcorper tincidunt quis ipsum.
        </p>
        <p>
        Vestibulum mollis nunc id purus mattis maximus. Duis hendrerit nunc ut mollis dapibus. Maecenas nulla velit, congue sit amet nulla eu, tincidunt egestas justo. In pretium mi eget efficitur faucibus. Proin tempor magna ut risus rhoncus venenatis. Proin non leo at tellus faucibus iaculis vel eget velit. Aliquam eget tincidunt dolor. Integer congue metus sed sem lacinia lobortis. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Suspendisse sollicitudin quis odio porta mattis.
        </p>
        <p>
        Vivamus eu pulvinar ligula. Proin ut cursus diam. Ut lacinia odio quis nibh aliquet aliquet. Fusce tincidunt augue felis, eget hendrerit ex elementum eget. Integer mattis sodales metus a viverra. Donec ipsum justo, ultrices a ultrices in, congue eget eros. Proin et aliquet leo. Nullam id elit tempor, aliquet est eget, venenatis metus. Etiam rhoncus nec sem sed venenatis. Donec aliquet id libero nec interdum. Nulla eget finibus massa. Integer vitae posuere ex. Vestibulum in aliquam ligula. Mauris erat neque, accumsan pharetra molestie id, bibendum nec lectus. Nam a ultricies lorem.
        </p>
        <p>
        Aenean ac maximus tortor. Nullam nec pharetra mauris. Etiam in velit quis sem tempor aliquet. Duis aliquam turpis elit, a venenatis magna accumsan vulputate. Quisque justo eros, aliquet sed ipsum sed, pellentesque aliquam nisi. Cras orci libero, tristique eu mauris vitae, tristique venenatis lorem. Integer ac vehicula velit. Mauris euismod mattis nunc, vel blandit tortor convallis a. Maecenas sollicitudin mattis risus sed mattis. Aenean faucibus, nibh eu molestie convallis, erat nulla faucibus mi, et malesuada dolor purus vitae elit. Vivamus imperdiet elit eget mauris iaculis, at eleifend mauris hendrerit. Phasellus id enim sed ipsum pretium posuere. Aenean faucibus lorem vel accumsan egestas. Ut sagittis mauris et lacus egestas, accumsan dapibus nunc posuere.
        </p>
        <p>
        Nullam eleifend quis lorem in bibendum. Nunc id consequat augue. Aenean iaculis a lectus at accumsan. Sed suscipit nunc metus, non placerat massa suscipit id. Duis suscipit placerat dolor. Suspendisse nec ornare ante. Aenean nulla lacus, lacinia at erat vitae, rhoncus euismod augue. Duis ullamcorper est ut neque euismod, ut consequat turpis condimentum. Nulla et ipsum mattis, vestibulum erat ut, semper turpis. Curabitur vehicula gravida urna, in ornare eros efficitur mattis.
        </p>
        <p>
        Vestibulum sagittis quam sed tellus semper rutrum. Vestibulum quis felis rutrum, dignissim mauris ut, consequat lacus. Nullam mauris augue, viverra ac convallis ac, ultrices a arcu. Vivamus vulputate felis at diam pulvinar, et malesuada nisi porttitor. Etiam varius risus a magna semper ultrices. Donec turpis mi, dapibus eu placerat et, viverra id neque. Morbi laoreet dui quam, sed pretium diam tincidunt sit amet. Nam viverra, dolor ut rhoncus ullamcorper, turpis ipsum placerat ipsum, sit amet condimentum orci justo vitae neque. Nulla interdum finibus sollicitudin. Curabitur sodales risus libero, ut scelerisque tortor feugiat nec. Aenean lectus turpis, convallis ac dui vel, auctor dapibus urna. Aenean volutpat iaculis quam. Quisque in ultrices dui. Interdum et malesuada fames ac ante ipsum primis in faucibus. Phasellus vel interdum odio. Aliquam ut ipsum nisi.
        </p>
        <p>
        Proin id mollis augue. Aliquam scelerisque, est eget venenatis ultrices, mi nibh ornare mauris, et scelerisque lectus velit ac est. In eget lacinia nibh. Donec vel tincidunt dui. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec fringilla arcu id nisi egestas, a malesuada libero facilisis. Interdum et malesuada fames ac ante ipsum primis in faucibus. Vestibulum in efficitur massa, vitae facilisis dui.
        </p>
        <p>
        Nulla ut mi libero. Pellentesque viverra dui orci, nec efficitur felis tempus in. Donec eu finibus arcu. Ut efficitur vulputate sapien, vel tincidunt tellus sollicitudin ut. Fusce nec tellus venenatis, eleifend nulla ut, fringilla eros. In ut hendrerit ex. Maecenas massa felis, ullamcorper at hendrerit vel, luctus sit amet ligula. Proin dictum feugiat purus. Mauris varius nisi augue, nec tempor nibh ultricies a. Etiam dui tellus, rhoncus sed nulla at, convallis placerat libero. Maecenas lobortis ut erat eu sodales.
        </p>
        <p>
        Quisque nulla elit, accumsan eget tortor eget, pharetra pellentesque mi. Donec ex sem, tempor eu tellus quis, luctus posuere ipsum. Curabitur mattis libero eros, a aliquam lorem placerat maximus. Phasellus varius ipsum eu leo mollis cursus. In tristique elementum tristique. Phasellus consequat erat felis, in bibendum nisi interdum eget. Aenean urna risus, vehicula ut hendrerit volutpat, finibus egestas lorem.
        </p>
        <p>
        Vestibulum malesuada suscipit ligula aliquet commodo. Sed pulvinar, lorem sed tincidunt scelerisque, ipsum metus consectetur dolor, vitae sodales eros diam id nisi. Suspendisse nec neque risus. Sed pretium ullamcorper gravida. Fusce porta erat libero, nec varius leo pulvinar eget. Suspendisse condimentum massa sit amet ante maximus, vitae molestie turpis ultrices. Sed malesuada nibh nec nibh finibus, vitae ultrices metus pulvinar. Maecenas et sapien varius, convallis purus ut, posuere sapien. Aliquam pretium dui vitae urna consequat vehicula. Donec commodo viverra auctor. Duis mattis rutrum risus, eget convallis elit facilisis quis. Sed dapibus lectus eu consequat ullamcorper. Quisque posuere neque et bibendum tempus. Sed faucibus mi urna, ac semper orci pretium porttitor. Pellentesque enim felis, hendrerit quis ornare quis, mollis eget dui. Vestibulum id enim at diam ullamcorper ultricies vel in risus.
        </p>
        <p>
        Curabitur imperdiet eros ac quam sollicitudin, at imperdiet neque elementum. Integer aliquet euismod ultricies. Fusce quis volutpat nulla. Mauris convallis a nisi ut tincidunt. Praesent maximus eros ex, eu accumsan ante cursus id. Suspendisse ultrices vestibulum facilisis. Praesent eu elit ligula. In hac habitasse platea dictumst. Cras id lectus augue. Suspendisse ac venenatis risus, sit amet efficitur ex.
        </p>
        <p>
        Nulla rhoncus id nibh eget condimentum. Morbi aliquam sed massa ut cursus. Phasellus porttitor nunc non arcu varius, quis viverra dui posuere. Maecenas viverra commodo leo a malesuada. Nam in tortor quam. Suspendisse ac libero urna. Nulla facilisi. Donec ac turpis vel risus interdum vulputate sit amet eu diam. Quisque mi nisi, blandit eu efficitur ac, sollicitudin non metus. In convallis nisi quis ante semper malesuada. Aenean pharetra eu felis in tincidunt. In elementum porta velit. Sed eleifend tempus nisi non sagittis. Aliquam felis metus, tincidunt vestibulum lobortis vel, hendrerit nec nisl.
        </p>
        <p>
        Sed a convallis elit, sit amet sollicitudin elit. Duis posuere, sem sit amet dignissim lacinia, augue metus sagittis nulla, dictum consequat eros elit ornare ex. Cras faucibus, nibh et dignissim fringilla, urna ligula tincidunt ligula, sed facilisis turpis est vel ipsum. Morbi lobortis erat vitae euismod sollicitudin. Vivamus urna quam, feugiat ac eros eget, consectetur tempus nisi. Proin finibus dui orci, a aliquet odio ullamcorper facilisis. Aenean mollis lorem vel facilisis laoreet. Phasellus dignissim, elit eget rutrum malesuada, erat lacus fermentum nulla, ut vestibulum diam eros sit amet ipsum. Vivamus vel nibh eu mauris dictum blandit. Vivamus justo augue, commodo fermentum commodo ullamcorper, efficitur sit amet orci. Curabitur ut erat turpis. Fusce non massa massa. Proin id hendrerit felis, id elementum nulla. Proin elementum odio vel lorem tincidunt sodales.
        </p>
        <p>
        Proin non justo felis. Vestibulum tellus erat, dignissim quis varius ac, ultricies in felis. Curabitur sed feugiat est. Cras at diam non nulla iaculis tempus. Suspendisse sed nibh a nisi feugiat pellentesque. Integer in lorem mattis, pretium ligula at, aliquam eros. Proin cursus mollis nisi sed pulvinar. Curabitur lobortis arcu sem, vitae pellentesque eros dapibus nec. Proin tempor dictum turpis at pellentesque. Morbi sed lectus in diam consequat posuere sed et nibh.
        </p>
    `;
        return resp;
    }

    function loremIpsum2(args) {
        const { div } = ft.html;
        return div(
            loremIpsum(`Lorem Ipsum 2 - ${args.join(",")}`)
        );
    }

    function page404()
    {
        const { h1 } = ft.html;
        return h1("404 - Page not found");
    }

    function decodeHash() {
        let hashName, args;
        let hash = /^(#[^(]*)(\(([^\)]*)\))?$/.exec(window.location.hash);
        if(hash) {
            hashName = hash[1];
            args = (hash[3] && hash[3].split(",").map(decodeURI)) || [];
        } else {
            hashName = "";
            args = [];
        }
        return { hashName, args }
    }

    function router(homePage, routes) {
        const { div } = ft.html;
        let placeholder = div({class:"router"});
        function updateHash() {
            let { hashName, args } = decodeHash();
            if(hashName == "") {
                window.open(homePage,"_self");
            } else {
                placeholder.replaceChildren((routes[hashName] || page404)(args));
                placeholder.dispatchEvent(new CustomEvent("pagechange",{bubbles:true,detail:{hashName,args}}));
            }
        }
        window.addEventListener("hashchange",updateHash);
        setTimeout(updateHash,1);
        return placeholder;
    }

    function horizontalFlexBox(...args) {
        const { div } = ft.html;
        return div({"class":"d-flex vh-100"},
            args.map(e=>div({style:{"overflow-y":"auto"}},e))
        );
    }

    function verticalFlexBox(...args) {
        const { div } = ft.html;
        args.forEach(e=>e.style["overflow-y"]="auto");
        return div({"class":"d-flex vh-100 flex-column"},
            args.map(e=>div({style:{"overflow-y":"auto"}},e))
        );
    }

    function testeVerticalBox() 
    {
        return horizontalFlexBox(
            loremIpsum(),
            verticalFlexBox(
                loremIpsum(),
                loremIpsum(),
                loremIpsum(),
            )
        );
    }

    const { div, label, input } = ft.html;

    function oneChoiceQuestion(question, itens, otherLabel) {

        let radioName = ("rd"+Math.random()).replace(".","");
        let radioAttributes = {
            class:"form-check-input",
            type:"radio",
            name:radioName,
            oninput(ev) {
                console.log(ev);
            }
        };

        return div(
            div(question),
            div(
                itens.map((d,i)=>
                    div({class:"input-group m-2"},
                        div({class:"input-group-text"},
                            input({id:`${radioName}-${i}`, ...radioAttributes}),
                        ),
                        label({class:"form-control", for:`${radioName}-${i}`},d)
                    )                
                ),
                (otherLabel?[otherLabel]:[]).map(d=>
                    div({class:"input-group m-2"},
                        div({class:"input-group-text"},
                            input({id:`${radioName}-other`,class:"form-check-input",type:"radio",name:radioName}),
                        ),
                        input({class:"form-control",type:"text",name:"tx",placeholder:d})
                    )                
                )
            )
        )
    }

    function formTeste()
    {
        const { div } = ft.html;

        return div({class:"container"},
            oneChoiceQuestion("Escolha um Fruta",["banana", "maçã", "laranja"],"outra")
        );
    }

    function bsRadioGroup(name, targetObject) {

        let otherList = [];
        const SYMB_TEXT = Symbol();

        function oninput(ev) {
            let otherText = null;
            let otherRadio = null;
            for(let [rd,tx] of otherList) {
                if(rd.checked) {
                    otherRadio = rd;
                    otherText = tx;
                    if(tx != ev.target) {
                        tx.removeAttribute("disabled");
                        tx.focus();
                        tx.setSelectionRange(0,tx.value.length);
                    }
                } else {
                    tx.setAttribute("disabled","disabled");
                }
            }
            if(otherText) {
                targetObject[name] = { value: otherRadio.value, text: otherText.value };
            } else {
                targetObject[name] = { value: ev.target.value, text: ev.target[SYMB_TEXT] };
            }
        }

        function item(value, text) {
            const { div, input, label } = ft.html;
            text ||= value;
            const rd = input({class:"form-check-input", type:"radio", oninput, name, value});
            rd[SYMB_TEXT] = text;
            return div (
                {class:"form-check"},
                label(
                    {class:"form-check-label py-1"},
                    rd,
                    text
                )
            );
        }
        
        function other(value,placeholder) {
            const { div, input, label } = ft.html;
            let rd, tx;

            rd = input({class:"form-check-input my-2", type:"radio", value, oninput, name});
            tx = input({class:"form-control form-control-sm",placeholder,disabled:"disabled",oninput,type:"text",style:{maxWidth:"250px"}});
            otherList.push([rd,tx]);

            return div (
                {class:"form-check form-check-inline"},
                label({class:"form-check-label",onclick:()=>rd.click()},rd,tx)
            );
        }

        return { item, other };
    }

    function formTeste2()
    {
        const { fieldset, label, div } = ft.html;

        let frutas = ["Laranja", "Banana", "Maçã", "Abacaxi", "Kiwi", "Melancia", "Melão", "Abacate", "Uva", "Fruta do Conde", "Cereja" ];
        let target = {};
        const radio = bsRadioGroup("fruta", target);

        return div(
                {class:"container",oninput},
                fieldset(
                    {class:"p-2 m-3"},
                    label({class:"form-label"},"Escolha uma fruta"),
                    div(
                        {class:"d-flex flex-column flex-wrap",style:{maxHeight:"150px"}},
                        frutas.map((d,i)=>radio.item(i+1,d)),
                        radio.other(99,"Other")
                    )
                )
            );
    }

    function generateName() {
        let tab = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz01234567890";
        let resp = ["_"];
        for(let i=0; i<30; i++) {
            resp.push(tab[Math.floor(Math.random()*tab.length)]);
        }
        return resp.join("");
    }

    function visitor(element, obj, callback) {
        if(("name" in element) && ("value" in element)) {
            callback(element, obj);
        } else {
            for(let i=0; i<element.children.length; i++) {
                visitor(element.children[i],obj,callback);
            }
        }
    }

    function elementData(attrs, rootElement) {
        let data = attrs.data || {};
        let oninput = attrs.oninput || (()=>{});

        rootElement.addEventListener("input",ev=>{
            visitor(rootElement, data,(element,obj) => {
                obj[element.name] = element.value;
            });
            oninput(ev);
            visitor(rootElement,data,(element,obj)=>{
                element.value = obj[element.name];
            });
        });

        visitor(rootElement,data,(element,obj)=>{
            element.value = obj[element.name];
        });
        return rootElement;
    }

    const SYMBOL_INDEX = Symbol();

    function radioGrid(name, questions, answers) {

        const radioNames = questions.map(_=>generateName());
        const { table, thead, tbody, th, tr, td, input } = ft.html;
        const hstyle = { class: `col-${12-answers.length}` };
        const qstyle = { class: "col-1 text-center" };

        function radio(i, value) {
            let resp = input({class:"form-check-input",type:"radio",name:radioNames[i],value});
            resp[SYMBOL_INDEX] = i;
            return resp;
        }

        let resp = table({class:"table table-striped"},
            thead(
                tr(
                    th(),
                    answers.map(([_,label])=>th({class:"text-center"},label))
                )
            ),
            tbody(
                questions.map((q,i)=>
                    tr(
                        td(hstyle,q),
                        answers.map(([value,_])=>
                            td(qstyle,radio(i,value))
                        )
                    )
                )
            )
        );

        Object.defineProperty(resp,"value",{
            get() {
                let a = [];
                resp.querySelectorAll("input:checked").forEach(rd => {
                    a[rd[SYMBOL_INDEX]] = rd.value; 
                });
                return a;
            },
            set(newValue) {
                resp.querySelectorAll("input").forEach(rd => {
                    if(newValue[rd[SYMBOL_INDEX]] == rd.value) {
                        rd.setAttribute("checked","checked");
                    } else {
                        rd.removeAttribute("checked");
                    }
                });
            }
        });

        Object.defineProperty(resp,"name",{
            get() {
                return name;
            }
        });

        return resp;
    }

    let questions = [
        "Eu acho que gostaria de usar esse sistema com frequência.",
        "Eu acho o sistema desnecessariamente complexo.",
        "Eu achei o sistema fácil de usar.",
        "Eu acho que precisaria de ajuda de uma pessoa com conhecimentos técnicos para usar o sistema.",
        "Eu acho que as várias funções do sistema estão muito bem integradas.",
        "Eu acho que o sistema apresenta muita inconsistência.",
        "Eu imagino que as pessoas aprenderão como usar esse sistema rapidamente.",
        "Eu achei o sistema atrapalhado de usar.",
        "Eu me senti confiante ao usar o sistema.",
        "Eu precisei aprender várias coisas novas antes de conseguir usar o sistema."
    ];

    let answers = [
        [ 1, "Discordo Totalmente 1" ],
        [ 2, "2" ],
        [ 3, "3" ],
        [ 4, "4" ],
        [ 5, "Concordo Totalmente 5" ],
    ];


    function uxSus() {

        let data = { sus: [1,2,3,3,2,3,4,5,1,2], obs: "RENATO" };

        const { div, textarea } = ft.html;
        
        function oninput() {
            console.log(data);
        }

        return elementData({data,oninput},
            div(
                {class:"container"},
                radioGrid("sus", questions, answers),
                textarea({name:"obs",rows:6,cols:80}),
            )
        );
    }

    const menuData = [{
        text: "Home",
        open: true,
        divideBefore: true,
        children: [
            { text: "Overview", href: "#home-overview" },
            { text: "Updates", href: "#home-updates" },
            { text: "Reports", href: "#home-reports" },
        ]
    },{
        text: "Dashbord",
        open: false,
        divideBefore: false,
        children: [
            { text: "Overview", href: "#dashbord-overview" },
            { text: "Weekly", href: "#dashboard-weekly" },
            { text: "Monthly", href: "#dashboard-monthly" },
            { text: "Annually", href: "#dashboard-annually" },
        ]
    },{
        text: "Orders",
        open: false,
        divideBefore: false,
        children: [
            { text: "New", href: "#orders-new" },
            { text: "Processed", href: "#orders-processed" },
            { text: "Shipped", href: "#orders-shipped" },
            { text: "Returned", href: "#orders-returned" },
        ]
    },{
        text: "Account",
        divideBefore: true,
        open: false,
        children: [
            { text: "New...", href: "#account-new" },
            { text: "Profile", href: "#account-profile" },
            { text: "Settings", href: "#account-settings" },
            { text: "Sign out", href: "#account-signout" },
        ]
    }];

    mainTemplate(

        "Título da Aplicação",

        menuData,

        router("#home-overview", {
            "#home-overview": loremIpsum,
            "#home-updates": loremIpsum2,
            "#home-reports": formTeste,
            "#dashbord-overview": testeVerticalBox,
            "#dashboard-weekly": formTeste2,
            "#dashboard-monthly": uxSus
        })

    );

}));
